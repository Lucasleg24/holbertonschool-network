#!/usr/bin/env bash

# Vérification des droits root
if [ "$EUID" -ne 0 ]; then 
    echo "Ce script nécessite les droits root (sudo)"
    exit 1
fi

# Affichage de l'en-tête pour les connexions Internet
echo "Active Internet connections (only servers)"
echo "Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name"

# Conversion de la sortie de ss au format souhaité
ss -tulnp | awk '
    NR>1 {
        if ($1 == "tcp") {
            printf "%-8s %-7d %-7d %-22s %-20s LISTEN     %s\n", $1, 0, 0, $5, "*:*", $7
        }
        else if ($1 == "udp") {
            printf "%-8s %-7d %-7d %-22s %-20s            %s\n", $1, 0, 0, $5, "*:*", $6
        }
    }'

echo

# Affichage de l'en-tête pour les sockets UNIX
echo "Active UNIX domain sockets (only servers)"
echo "Proto RefCnt Flags       Type       State         I-Node   PID/Program name    Path"

# Affichage des sockets UNIX en écoute avec formatage
ss -xlp | awk '
    NR>1 && /LISTEN/ {
        printf "unix  %-6d [ ACC ]     STREAM     LISTENING     %-8d %s    %s\n", 2, $5, $7, $8
    }'